---
const { lang = 'es' } = Astro.props;
import { useTranslations } from '../i18n';
const t = useTranslations(lang);

const isEnglish = lang === 'en';
const toggleLangUrl = isEnglish ? '/' : '/en/';
---

<!-- Header principal (visible siempre, nav desktop solo >= 1120px) -->
<header class="header">
  <div class="container">
    <div class="header__inner">
      <a href={`/${lang === 'en' ? 'en/' : ''}`} class="header__logo">
        <img src="/images/header-logo.svg" alt="Calablanca Residences" class="header__logo-img" />
      </a>

      <nav class="header__nav">
        <ul class="header__nav-list">
          <li><a href="#residence">{t('nav.residence')}</a></li>
          <li><a href="#location">{t('nav.location')}</a></li>
          <li><a href="#houses">{t('nav.houses')}</a></li>
          <li><a href="#calculator">{t('nav.calculator')}</a></li>
          <li><a href="#contact">{t('nav.contact')}</a></li>
          <li><a href={toggleLangUrl}>{isEnglish ? 'ES' : 'EN'}</a></li>
        </ul>
      </nav>
    </div>
  </div>
</header>

<!-- Navegación fullscreen mobile (solo < 1120px) -->
<nav data-navigation-status="not-active" class="bold-nav-full">
  <div class="bold-nav-full__bar">
    <a href={`/${lang === 'en' ? 'en/' : ''}`} class="bold-nav-full__logo">
      <img src="/images/header-logo.svg" alt="Calablanca Residences" />
    </a>
    <button data-navigation-toggle="toggle" class="bold-nav-full__hamburger" aria-label="Menu">
      <div class="bold-nav-full__hamburger-bar"></div>
      <div class="bold-nav-full__hamburger-bar"></div>
      <div class="bold-nav-full__hamburger-bar"></div>
    </button>
  </div>
  <div class="bold-nav-full__tile">
    <ul class="bold-nav-full__ul">
      <li class="bold-nav-full__li">
        <a href="#residence" data-navigation-toggle="close" class="bold-nav-full__link">
          <span class="bold-nav-full__link-text">{t('nav.residence')}</span>
        </a>
      </li>
      <li class="bold-nav-full__li">
        <a href="#location" data-navigation-toggle="close" class="bold-nav-full__link">
          <span class="bold-nav-full__link-text">{t('nav.location')}</span>
        </a>
      </li>
      <li class="bold-nav-full__li">
        <a href="#houses" data-navigation-toggle="close" class="bold-nav-full__link">
          <span class="bold-nav-full__link-text">{t('nav.houses')}</span>
        </a>
      </li>
      <li class="bold-nav-full__li">
        <a href="#calculator" data-navigation-toggle="close" class="bold-nav-full__link">
          <span class="bold-nav-full__link-text">{t('nav.calculator')}</span>
        </a>
      </li>
      <li class="bold-nav-full__li">
        <a href="#contact" data-navigation-toggle="close" class="bold-nav-full__link">
          <span class="bold-nav-full__link-text">{t('nav.contact')}</span>
        </a>
      </li>
    </ul>
    <div class="bold-nav__bottom">
      <a href={toggleLangUrl} class="bold-nav__lang">{isEnglish ? 'ES' : 'EN'}</a>
      <p class="bold-nav__word">info@calablanca.es</p>
    </div>
  </div>
</nav>

<style>
  /* ================================
     HEADER DESKTOP (>= 1120px)
     ================================ */
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    transition: transform 0.3s ease;
    display: none;
  }

  .header--top {
    mix-blend-mode: normal;
  }

  .header--top .header__nav-list a {
    color: var(--color-white);
  }

  .header--scrolled {
    mix-blend-mode: exclusion;
  }

  .header--hidden {
    transform: translateY(-100%);
  }

  .header__inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-md) 0;
    gap: var(--space-md);
  }

  .header__logo-img {
    height: 2rem;
    width: auto;
  }

  .header__nav-list {
    display: flex;
    gap: var(--space-md);
    list-style: none;
    align-items: center;
  }

  .header__nav-list a {
    font-family: var(--font-heading);
    font-size: var(--font-size-small);
    font-weight: 400;
    color: #e0e0e0;
    transition: color var(--transition-fast), opacity var(--transition-fast);

    &:hover {
      opacity: 0.8;
    }
  }

  /* ================================
     BOLD NAV FULLSCREEN (< 1120px)
     ================================ */
  .bold-nav-full {
    z-index: 100;
    pointer-events: none;
    position: fixed;
    inset: 0;
  }

  .bold-nav-full__bar {
    z-index: 1;
    justify-content: space-between;
    width: 100%;
    padding: var(--space-md);
    display: flex;
    position: absolute;
  }

  .bold-nav-full__logo {
    pointer-events: auto;
    display: flex;
    align-items: center;
  }

  .bold-nav-full__logo img {
    height: 2rem;
    width: auto;
  }

  /* Hamburger */
  .bold-nav-full__hamburger {
    pointer-events: auto;
    color: var(--color-white);
    cursor: pointer;
    background-color: transparent;
    border: none;
    justify-content: center;
    align-items: center;
    width: 3em;
    height: 3em;
    display: flex;
    position: relative;
    overflow: hidden;
  }

  .bold-nav-full__hamburger .bold-nav-full__hamburger-bar {
    background-color: currentColor;
    width: 2em;
    height: 2px;
    position: absolute;
    transform: translate(0, 0) rotate(0.001deg);
    transition: transform 0.5s cubic-bezier(.7, 0, .3, 1);
  }

  .bold-nav-full__hamburger .bold-nav-full__hamburger-bar:nth-child(1) {
    transform: translate(0, -0.45em) scale(1, 1) rotate(0.001deg);
  }

  .bold-nav-full__hamburger .bold-nav-full__hamburger-bar:nth-child(3) {
    transform: translate(0, 0.45em) scale(1, 1) rotate(0.001deg);
  }

  /* Hamburger Hover */
  .bold-nav-full__hamburger:hover .bold-nav-full__hamburger-bar:nth-child(1) {
    transform: translate(0, -0.45em) scale(0.5, 1) rotate(0.001deg);
  }

  .bold-nav-full__hamburger:hover .bold-nav-full__hamburger-bar:nth-child(3) {
    transform: translate(0, 0.45em) scale(0.5, 1) rotate(0.001deg);
  }

  /* Hamburger activo (X) */
  [data-navigation-status="active"] .bold-nav-full__hamburger-bar:nth-child(1) {
    transform: translate(0, 0) rotate(45deg) scale(1, 1);
  }

  [data-navigation-status="active"] .bold-nav-full__hamburger-bar:nth-child(2) {
    transform: translate(-150%, 0) rotate(0.001deg) scale(1, 1);
  }

  [data-navigation-status="active"] .bold-nav-full__hamburger-bar:nth-child(3) {
    transform: translate(0, 0) rotate(-45deg) scale(1, 1);
  }

  /* Hamburger Hover cuando activo */
  [data-navigation-status="active"] .bold-nav-full__hamburger:hover .bold-nav-full__hamburger-bar:nth-child(1) {
    transform: translate(0, 0) rotate(45deg) scale(0.7, 1);
  }

  [data-navigation-status="active"] .bold-nav-full__hamburger:hover .bold-nav-full__hamburger-bar:nth-child(3) {
    transform: translate(0, 0) rotate(-45deg) scale(0.7, 1);
  }

  /* Tile (panel fullscreen) */
  .bold-nav-full__tile {
    pointer-events: auto;
    background-color: var(--color-dark);
    flex-flow: column;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    display: flex;
    position: absolute;
    top: 0;
    left: 0;
    transition: clip-path 1s cubic-bezier(.9, 0, .1, 1);
    clip-path: polygon(0% 0%, 100% 0%, 100% 0%, 0% 0%);
  }

  [data-navigation-status="active"] .bold-nav-full__tile {
    clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%);
  }

  .bold-nav-full__ul {
    flex-flow: column;
    align-items: center;
    margin: 0;
    padding: 0;
    display: flex;
    list-style: none;
  }

  .bold-nav-full__li {
    justify-content: center;
    align-items: center;
    margin: 0;
    padding: 0;
    text-decoration: none;
    display: flex;
    position: relative;
    overflow: hidden;
  }

  .bold-nav-full__link {
    color: var(--color-white);
    letter-spacing: -0.04em;
    padding-left: 0.075em;
    padding-right: 0.075em;
    font-family: var(--font-heading);
    font-size: clamp(2rem, 8vw, 4rem);
    font-weight: 400;
    line-height: 1.2;
    text-decoration: none;
    transform: translateY(100%) rotate(5deg);
    transition: transform 0.75s cubic-bezier(.7, 0, .3, 1);
  }

  .bold-nav-full__li:nth-child(1) .bold-nav-full__link { transition-delay: 0.2s; }
  .bold-nav-full__li:nth-child(2) .bold-nav-full__link { transition-delay: 0.15s; }
  .bold-nav-full__li:nth-child(3) .bold-nav-full__link { transition-delay: 0.1s; }
  .bold-nav-full__li:nth-child(4) .bold-nav-full__link { transition-delay: 0.05s; }
  .bold-nav-full__li:nth-child(5) .bold-nav-full__link { transition-delay: 0s; }

  /* Links cuando nav activa */
  [data-navigation-status="active"] .bold-nav-full__link {
    transform: translateY(0%) rotate(0.001deg);
    transition-delay: 0.3s;
  }

  [data-navigation-status="active"] .bold-nav-full__li:nth-child(1) .bold-nav-full__link { transition-delay: 0.3s; }
  [data-navigation-status="active"] .bold-nav-full__li:nth-child(2) .bold-nav-full__link { transition-delay: 0.35s; }
  [data-navigation-status="active"] .bold-nav-full__li:nth-child(3) .bold-nav-full__link { transition-delay: 0.4s; }
  [data-navigation-status="active"] .bold-nav-full__li:nth-child(4) .bold-nav-full__link { transition-delay: 0.45s; }
  [data-navigation-status="active"] .bold-nav-full__li:nth-child(5) .bold-nav-full__link { transition-delay: 0.5s; }

  .bold-nav-full__link-text {
    text-shadow: 0 1.1em 0;
    display: block;
    position: relative;
  }

  /* Links hover efecto opacidad */
  .bold-nav-full__li {
    transition: opacity 0.5s cubic-bezier(.7, 0, .3, 1);
  }

  .bold-nav-full__ul:has(.bold-nav-full__li:hover) .bold-nav-full__li {
    opacity: 0.15;
  }

  .bold-nav-full__ul:has(.bold-nav-full__li:hover) .bold-nav-full__li:hover {
    opacity: 1;
  }

  /* Links hover texto slide */
  .bold-nav-full__link .bold-nav-full__link-text {
    transition: transform 0.5s cubic-bezier(.7, 0, .3, 1);
    transform: translateY(0%) rotate(0.001deg);
  }

  .bold-nav-full__link:hover .bold-nav-full__link-text {
    transform: translateY(-100%) rotate(0.001deg);
  }

  /* Bottom bar */
  .bold-nav__bottom {
    justify-content: space-between;
    align-items: center;
    width: 100%;
    padding: var(--space-lg);
    display: flex;
    position: absolute;
    bottom: 0;
    left: 0;
  }

  .bold-nav__word {
    opacity: 0.5;
    margin-bottom: 0;
    font-size: 1rem;
    color: var(--color-white);
  }

  .bold-nav__lang {
    font-family: var(--font-heading);
    font-size: 1rem;
    color: var(--color-white);
    opacity: 0.7;
    transition: opacity var(--transition-fast);

    &:hover {
      opacity: 1;
    }
  }

  /* ================================
     RESPONSIVE: Desktop >= 1120px
     ================================ */
  @media (min-width: 1120px) {
    .header {
      display: block;
    }

    .bold-nav-full {
      display: none;
    }
  }
</style>

<script>
  // ================================
  // Header Desktop - Scroll behavior
  // ================================
  const header = document.querySelector('.header');
  let lastScrollY = 0;
  const scrollThreshold = 50;

  function handleScroll() {
    const currentScrollY = window.scrollY;

    if (currentScrollY <= scrollThreshold) {
      header.classList.add('header--top');
      header.classList.remove('header--scrolled');
      header.classList.remove('header--hidden');
    } else {
      header.classList.remove('header--top');
      header.classList.add('header--scrolled');

      if (currentScrollY > lastScrollY) {
        header.classList.add('header--hidden');
      } else {
        header.classList.remove('header--hidden');
      }
    }

    lastScrollY = currentScrollY;
  }

  window.addEventListener('scroll', handleScroll);
  handleScroll();

  // ================================
  // Bold Nav Fullscreen (Mobile)
  // ================================
  function initBoldFullScreenNavigation() {
    // Toggle Navigation
    document.querySelectorAll('[data-navigation-toggle="toggle"]').forEach(toggleBtn => {
      toggleBtn.addEventListener('click', () => {
        const navStatusEl = document.querySelector('[data-navigation-status]');
        if (!navStatusEl) return;

        if (navStatusEl.getAttribute('data-navigation-status') === 'not-active') {
          navStatusEl.setAttribute('data-navigation-status', 'active');
          document.body.style.overflow = 'hidden';
        } else {
          navStatusEl.setAttribute('data-navigation-status', 'not-active');
          document.body.style.overflow = '';
        }
      });
    });

    // Close Navigation (para links del menú)
    document.querySelectorAll('[data-navigation-toggle="close"]').forEach(closeBtn => {
      closeBtn.addEventListener('click', () => {
        const navStatusEl = document.querySelector('[data-navigation-status]');
        if (!navStatusEl) return;
        navStatusEl.setAttribute('data-navigation-status', 'not-active');
        document.body.style.overflow = '';
      });
    });

    // ESC key - Close Navigation
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') {
        const navStatusEl = document.querySelector('[data-navigation-status]');
        if (!navStatusEl) return;
        if (navStatusEl.getAttribute('data-navigation-status') === 'active') {
          navStatusEl.setAttribute('data-navigation-status', 'not-active');
          document.body.style.overflow = '';
        }
      }
    });
  }

  initBoldFullScreenNavigation();
</script>
